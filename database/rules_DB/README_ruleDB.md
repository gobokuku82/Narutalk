# ì œì•½ ì˜ì—… ê·œì œ ì¤€ìˆ˜ ê²€ìƒ‰ ì‹œìŠ¤í…œ (Rule_DB)

## ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”

ì œì•½ ì˜ì—… ë‹´ë‹¹ìë¥¼ ìœ„í•œ í•œêµ­ ì˜ì•½í’ˆ ê·œì œ ê²€ìƒ‰ ë° ë‹µë³€ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì²­íƒê¸ˆì§€ë²•, ì•½ì‚¬ë²•, ê³µì •ê²½ìŸê·œì•½ ë“±ì˜ ê·œì œë¥¼ ìì—°ì–´ë¡œ ê²€ìƒ‰í•˜ê³  ì‹¤ë¬´ì— ì ìš© ê°€ëŠ¥í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- ğŸ” **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**: ë²¡í„° ìœ ì‚¬ë„ + ë©”íƒ€ë°ì´í„° í•„í„°ë§
- ğŸ¤– **GPT-4o í†µí•©**: ìì—°ì–´ ë‹µë³€ ìƒì„±
- âš–ï¸ **ì¶©ëŒ í•´ê²°**: ë²•ë ¹ ê°„ ìš°ì„ ìˆœìœ„ ìë™ ì ìš©
- ğŸ“Š **êµ¬ì¡°í™”ëœ ë°ì´í„°**: ê¸ˆì•¡, ë¹ˆë„, ëŒ€ìƒ ë“± ë©”íƒ€ë°ì´í„° ì¶”ì¶œ

## ğŸ—‚ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
database/
â”œâ”€â”€ Rule_DB/
â”‚   â”œâ”€â”€ chroma_db/           # ChromaDB ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”‚   â””â”€â”€ [ë²¡í„° ì¸ë±ìŠ¤ íŒŒì¼ë“¤]
â”‚   â”œâ”€â”€ search_engine.py     # ê¸°ë³¸ ê²€ìƒ‰ ì—”ì§„
â”‚   â”œâ”€â”€ gpt_enhanced_search.py  # GPT-4o í†µí•© ê²€ìƒ‰
â”‚   â”œâ”€â”€ conflict_resolver.py    # ë²•ë ¹ ì¶©ëŒ í•´ê²°
â”‚   â””â”€â”€ README.md            # ë³¸ ë¬¸ì„œ
â”œâ”€â”€ test_data/
â”‚   â””â”€â”€ test_chunks.json    # í…ŒìŠ¤íŠ¸ìš© ì²­í‚¹ ë°ì´í„° (11ê°œ)
â””â”€â”€ models/
    â””â”€â”€ kure_v1/            # KURE-v1 ì„ë² ë”© ëª¨ë¸ (ë¡œì»¬)
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ChromaDB Collection: `compliance_chunks`
- **ì°¨ì›**: 1024 (KURE-v1 ì„ë² ë”©)
- **ì´ ë¬¸ì„œ ìˆ˜**: 11ê°œ ì²­í¬
- **ê±°ë¦¬ ì¸¡ì •**: cosine similarity

### ë©”íƒ€ë°ì´í„° í•„ë“œ

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|------|
| `law_name` | string | ë²•ë ¹ëª… | "ê³µì •ê²½ìŸê·œì•½", "ì²­íƒê¸ˆì§€ë²•", "ì•½ì‚¬ë²•" |
| `article` | string | ì¡°í•­ | "ì œ10ì¡°", "ì œ8ì¡°" |
| `prohibition_type` | string | ê¸ˆì§€ ìœ í˜• | "ì¡°ê±´ë¶€í—ˆìš©", "ì ˆëŒ€ê¸ˆì§€" |
| `limit_value` | number | ê¸ˆì•¡ í•œë„ (ì›) | 100000, 350000 |
| `frequency_count` | number | ë¹ˆë„ íšŸìˆ˜ | 4, 1 |
| `frequency_period` | string | ë¹ˆë„ ê¸°ê°„ | "month", "year" |
| `activity` | string | í™œë™ ìœ í˜• | "ì œí’ˆì„¤ëª…íšŒ", "í•™ìˆ ëŒ€íšŒ", "ê°•ì—°" |
| `target` | string | ëŒ€ìƒ | "ìš”ì–‘ê¸°ê´€", "ì˜ë£Œì¸", "ê³µì§ì" |
| `target_type` | string | ëŒ€ìƒ ìœ í˜• | "ë³µìˆ˜ê¸°ê´€", "ê°œë³„ê¸°ê´€" |
| `item_type` | string | í•­ëª© ìœ í˜• | "ì‹ìŒë£Œ", "ìˆ™ë°•ë¹„", "ì„ ë¬¼" |
| `conditions` | string | ì¡°ê±´ (ë¦¬ìŠ¤íŠ¸â†’ë¬¸ìì—´) | "ìµœì†Œí¬ì¥ë‹¨ìœ„,ê²¬ë³¸í’ˆí‘œì‹œ" |

## ğŸ” ê²€ìƒ‰ ì—”ì§„ API

### 1. ê¸°ë³¸ ê²€ìƒ‰ ì—”ì§„ (search_engine.py)

```python
from search_engine import ComplianceSearchEngine, SearchQuery

# ì—”ì§„ ì´ˆê¸°í™”
engine = ComplianceSearchEngine(chunks_file="test_chunks.json")

# ê²€ìƒ‰ ì‹¤í–‰
query = SearchQuery(text="ëŒ€í•™ë³‘ì› êµìˆ˜ ì‹ì‚¬", top_k=5)
results = engine.search(query)

# ê²°ê³¼ ì²˜ë¦¬
for result in results:
    print(f"ë²•ë ¹: {result.source_law}")
    print(f"ë‚´ìš©: {result.text}")
    print(f"ì ìˆ˜: {result.score:.2f}")
```

### 2. GPT í†µí•© ê²€ìƒ‰ (gpt_enhanced_search.py)

```python
from gpt_enhanced_search import GPTEnhancedSearchEngine

# ì—”ì§„ ì´ˆê¸°í™” (OpenAI API í‚¤ í•„ìš”)
engine = GPTEnhancedSearchEngine(chunks_file="test_chunks.json")

# ìì—°ì–´ ì§ˆë¬¸
result = engine.search_and_answer(
    query="ëŒ€í•™ë³‘ì› êµìˆ˜ë‹˜ê»˜ 10ë§Œì› ì‹ì‚¬ ëŒ€ì ‘ ê°€ëŠ¥í•œê°€ìš”?",
    top_k=5
)

# GPT ë‹µë³€ ì¶œë ¥
print(result.gpt_answer)
print(f"ì‹ ë¢°ë„: {result.confidence:.1%}")
```

## ğŸ“ ìƒ˜í”Œ ë°ì´í„° (test_chunks.json)

í˜„ì¬ 11ê°œì˜ í…ŒìŠ¤íŠ¸ ì²­í¬ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **test_001**: ì œí’ˆì„¤ëª…íšŒ ì‹ìŒë£Œ ì œê³µ (ì›” 4íšŒ, 1íšŒ 10ë§Œì›)
2. **test_002**: í•´ì™¸ í•™ìˆ ëŒ€íšŒ ìˆ™ë°•ë¹„ (1ë°• 35ë§Œì›)
3. **test_003**: ì˜ì•½í’ˆ ê²¬ë³¸í’ˆ ì œê³µ ê·œì •
4. **test_004**: ê°•ì—°ë£Œ í•œë„ (1íšŒ 50ë§Œì›, ì—° 300ë§Œì›)
5. **test_005**: ê³µì§ì ì„ ë¬¼ ì œê³µ ê¸ˆì§€
6. **test_006**: ë³µìˆ˜ ìš”ì–‘ê¸°ê´€ ì œí’ˆì„¤ëª…íšŒ
7. **test_007**: ì„ìƒì‹œí—˜ ë¹„ìš© ì§€ê¸‰
8. **test_008**: ì‹œíŒí›„ì¡°ì‚¬ ëŒ€ê°€ ì§€ê¸‰
9. **test_009**: í•™ìˆ ëŒ€íšŒ ê¸°ë…í’ˆ ì œê³µ
10. **test_010**: ì˜ë£Œì¸ ê²½ì œì  ì´ìµ ì œê³µ ê¸ˆì§€
11. **test_011**: ëŒ€í•™ë³‘ì› êµìˆ˜ ì²­íƒê¸ˆì§€ë²• ì ìš©

## âš–ï¸ ë²•ë ¹ ìš°ì„ ìˆœìœ„

ì¶©ëŒ ì‹œ ë‹¤ìŒ ìˆœì„œë¡œ ìš°ì„  ì ìš©ë©ë‹ˆë‹¤:
1. **ì²­íƒê¸ˆì§€ë²•** (ê°€ì¥ ì—„ê²©)
2. **ì•½ì‚¬ë²•**
3. **ê³µì •ê²½ìŸê·œì•½** (ê°€ì¥ ìœ ì—°)

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env)

```env
OPENAI_API_KEY=your_api_key_here
HUGGINGFACE_TOKEN=your_token_here
```

### 3. ëŒ€í™”í˜• ëª¨ë“œ ì‹¤í–‰

```bash
python gpt_enhanced_search.py
```

### 4. í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì‚¬ìš©

```python
# ì§ˆë¬¸ ì˜ˆì‹œ
questions = [
    "ëŒ€í•™ë³‘ì› êµìˆ˜ë‹˜ê»˜ ì‹ì‚¬ ëŒ€ì ‘ì´ ê°€ëŠ¥í•œê°€ìš”?",
    "í•´ì™¸ í•™ìˆ ëŒ€íšŒ ì§€ì› í•œë„ëŠ” ì–¼ë§ˆì¸ê°€ìš”?",
    "ì˜ë£Œì§„ì—ê²Œ ì„ ë¬¼ì„ ì¤„ ìˆ˜ ìˆë‚˜ìš”?"
]

# ì¼ê´„ ì²˜ë¦¬
engine = GPTEnhancedSearchEngine()
for question in questions:
    result = engine.search_and_answer(question)
    print(f"Q: {question}")
    print(f"A: {result.gpt_answer}")
    print("-" * 50)
```

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

- **ê²€ìƒ‰ ì†ë„**: < 500ms (11ê°œ ì²­í¬ ê¸°ì¤€)
- **ì„ë² ë”© ì°¨ì›**: 1024 (KURE-v1)
- **ë‹µë³€ ìƒì„±**: 1-2ì´ˆ (GPT-4o)
- **ì •í™•ë„**: ë²•ë ¹ ìš°ì„ ìˆœìœ„ 100% ì¤€ìˆ˜

## ğŸ”§ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### ìƒˆë¡œìš´ ë¬¸ì„œ ì¶”ê°€

1. ë¬¸ì„œë¥¼ ì²­í‚¹í•˜ì—¬ test_chunks.json í˜•ì‹ìœ¼ë¡œ ì €ì¥
2. ë©”íƒ€ë°ì´í„° í•„ë“œ ì¶”ì¶œ ë° êµ¬ì¡°í™”
3. ChromaDBì— ì„ë² ë”© ì¶”ê°€

```python
# ìƒˆ ì²­í¬ ì¶”ê°€ ì˜ˆì‹œ
new_chunk = {
    "chunk_id": "custom_001",
    "text": "ìƒˆë¡œìš´ ê·œì œ ë‚´ìš©...",
    "metadata": {
        "law_name": "ê³µì •ê²½ìŸê·œì•½",
        "article": "ì œ15ì¡°",
        "limit_value": 50000
    }
}
```

### ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì¡°ì •

```python
# search_engine.pyì—ì„œ ì¡°ì • ê°€ëŠ¥
self.weight_vector = 0.7  # ë²¡í„° ê²€ìƒ‰ ê°€ì¤‘ì¹˜
self.weight_metadata = 0.3  # ë©”íƒ€ë°ì´í„° ê°€ì¤‘ì¹˜
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. **ëª¨ë¸ ê²½ë¡œ**: KURE-v1 ëª¨ë¸ì´ ë¡œì»¬ì— ìˆì–´ì•¼ í•¨
   - ê²½ë¡œ: `C:\kdy\Projects\Narutalk_V003\beta_v0031\database\models\kure_v1`

2. **API í‚¤**: GPT-4o ì‚¬ìš© ì‹œ OpenAI API í‚¤ í•„ìš”

3. **ì¸ì½”ë”©**: í•œêµ­ì–´ ì²˜ë¦¬ë¥¼ ìœ„í•´ UTF-8 ì¸ì½”ë”© í•„ìˆ˜

4. **Windows í˜¸í™˜**: ì´ëª¨ì§€ ëŒ€ì‹  í…ìŠ¤íŠ¸ ë§ˆì»¤ ì‚¬ìš©

## ğŸ“ ë¬¸ì˜ ë° ê°œì„ ì‚¬í•­

ì¶”ê°€ ê·œì œ ë¬¸ì„œ í†µí•©ì´ë‚˜ ê¸°ëŠ¥ ê°œì„ ì´ í•„ìš”í•œ ê²½ìš° ì´ìŠˆë¥¼ ë“±ë¡í•´ ì£¼ì„¸ìš”.

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

ì´ READMEë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- ì‹¤ì œ ê·œì œ ë¬¸ì„œ ì „ì²´ ì²˜ë¦¬ ë° í†µí•©
- ì›¹ ì¸í„°í˜ì´ìŠ¤ ê°œë°œ
- ëª¨ë°”ì¼ ì•± API ì„œë²„ êµ¬ì¶•
- ê·œì œ ì—…ë°ì´íŠ¸ ìë™í™” ì‹œìŠ¤í…œ