# 제약 영업 규제 준수 시스템 - 프로젝트 규칙

## 🎯 프로젝트 목표
제약 영업사원이 의료진 접촉 시 법규 위반을 실시간으로 확인할 수 있는 AI 기반 규정 검색 시스템 구축

## 📋 핵심 규칙

### 1. 청킹 규칙
- **크기**: 50-300자 (최적 150자)
- **단위**: 하나의 완결된 의미 단위
- **중첩**: 30자 overlap으로 문맥 유지
- **분리 기준**:
  - 금액 제한별
  - 조건별 (절대금지/조건부허용/허용)
  - 대상별 (의료인/요양기관/공직자)

### 2. 메타데이터 필수 항목
```json
{
  "law_name": "법령명",
  "article": "조항",
  "prohibition_type": "금지유형",
  "limit_value": "한도금액",
  "frequency": "빈도제한",
  "target": "적용대상",
  "conditions": "적용조건"
}
```

### 3. 법령 우선순위
1. 청탁금지법 (최우선)
2. 약사법
3. 공정거래법  
4. 공정경쟁규약
5. 가이드라인

**충돌 시**: 가장 엄격한 기준 적용

### 4. 특수 처리 규칙

#### 금액 표기
- "10만원" → 100000 (정수 변환)
- VAT 포함 여부 명시
- 기간별 한도 구분 (1회/월/연)

#### 예외 조항
- "다만", "단," → 별도 청크 생성
- 원칙과 예외를 연결하는 reference 유지

#### 빈도 제한
- "월 4회" → {"count": 4, "period": "month"}
- 리셋 주기 명시

### 5. 실무 시나리오 매핑

| 시나리오 | 관련 규정 | 핵심 제한 |
|---------|----------|----------|
| 병원 방문 식사 | 공정경쟁규약 제10조 | 월 4회, 10만원/회 |
| 학술대회 지원 | 공정경쟁규약 제9조 | 협회 기탁, 숙박 20만원/박 |
| 견본품 제공 | 공정경쟁규약 제6조 | 최소포장, 견본품 표시 |
| 강연료 | 공정경쟁규약 제16조 | 50만원/회, 연 300만원 |

### 6. 검색 최적화 규칙

#### 쿼리 분석
- 자연어 → 구조화 메타데이터 변환
- 동의어 자동 확장
- 문맥 기반 의도 파악

#### 검색 전략
1. 메타데이터 필터 (1차)
2. 벡터 유사도 (2차)
3. 규정 충돌 해결 (3차)
4. 실무 맥락 추가 (4차)

### 7. 답변 생성 규칙

#### 구조
```
[답변] 가능/불가능/조건부가능
[조건] 구체적 제한사항
[근거] 법령 조항
[주의] 실무 주의사항
```

#### 톤
- 명확하고 단정적
- 실무 용어 사용
- 예시 포함

### 8. 품질 기준

| 항목 | 목표 | 측정 방법 |
|-----|------|----------|
| 정확도 | 95% | 테스트 케이스 통과율 |
| 속도 | <500ms | 평균 응답 시간 |
| 커버리지 | 98% | 시나리오 처리율 |
| 메타데이터 | 90% | 필수 필드 완성도 |

### 9. 코딩 규칙

#### Python 스타일
```python
# Type hints 필수
def chunk_text(text: str, size: int = 150) -> List[Dict[str, Any]]:
    """
    텍스트를 지정된 크기로 청킹
    
    Args:
        text: 원본 텍스트
        size: 청크 크기
    
    Returns:
        청킹된 결과 리스트
    """
    pass
```

#### 에러 처리
- 모든 외부 입력 검증
- 명시적 예외 처리
- 로깅 필수

### 10. 파일 구조
```
project/
├── data/
│   ├── raw/           # 원본 문서
│   ├── processed/     # 청킹된 데이터
│   └── metadata/      # 메타데이터
├── src/
│   ├── chunker.py     # 청킹 모듈
│   ├── search.py      # 검색 엔진
│   └── resolver.py    # 충돌 해결
├── tests/
│   └── test_*.py      # 테스트 파일
└── config/
    └── settings.yaml  # 설정 파일
```

### 11. 테스트 필수 시나리오

1. "대학병원 교수 점심 대접"
2. "해외 학술대회 참가비"
3. "제품 샘플 제공 규정"
4. "월 방문 횟수 제한"
5. "강연료 연간 한도"
6. "명절 선물 가능 여부"
7. "복수 기관 설명회"
8. "임상시험 지원금"
9. "시판후조사 보상"
10. "기념품 제공 기준"

### 12. 금지 사항

❌ 하지 말아야 할 것:
- 전체 조문을 하나의 청크로 저장
- 메타데이터 없는 텍스트만 저장
- 법령 우선순위 무시
- 예외 조항 누락
- 금액을 문자열로 저장

✅ 반드시 해야 할 것:
- 의미 단위로 세분화
- 풍부한 메타데이터 추가
- 충돌 해결 로직 구현
- 실무 시나리오 테스트
- 성능 벤치마킹

## 🚀 시작하기

1. 원본 문서를 `data/raw/`에 저장
2. `implementation_prompt.md` 참조하여 구현
3. `pharma_compliance_chunking_plan.md`의 상세 설계 따르기
4. 테스트 케이스 모두 통과 확인
5. 성능 지표 달성 검증

## 📞 문의사항

구현 중 불명확한 부분은 다음 우선순위로 결정:
1. 가장 보수적(엄격한) 해석
2. 실무 관행 고려
3. 사용자 안전 우선
